<!DOCTYPE html>
<html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<title>3D Model Image Search</title>
    </head>
    <body class="bg-gray-100 flex flex-col min-h-screen">
        <script src="https://js.puter.com/v2/"></script>
        <header class="bg-red-500 text-white p-4">
            <div class="container mx-auto">
                <h1 class="text-3xl font-bold">3D Model Image Search</h1>
                
            </div>
        </header>


        <input type="file" id="imageInput" accept="image/*">
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 rounded" onclick="convertImage()">Search for 3D Model</button>
        





        <script>

        var modelName = undefined
        function convertImage() {
            const input = document.getElementById('imageInput');
            console.log("running")
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const dataURL = event.target.result;
                    console.log("Converted, sending to fuction")
                    console.log(dataURL)
                    findModel(dataURL);
                };
                reader.readAsDataURL(input.files[0]);
            } else {
                alert('Please select an image file first.');
            }
        }
        async function fetchModel(model) {
    const url = `https://api.thingiverse.com/search/${model}/?type=things&page=1&per_page=1&sort=relevant`;
    const apiKey = '6a316119bf8d82a1268b0f6d4b3cd470';
   
    
    try {
        const response = await fetch(url, {
            headers: {
                'Authorization': `Bearer ${apiKey}`
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching data:', error);
        return null;
    }
}
        function findModel(image) {
        puter.ai.chat(
            `If this image was made into a 3D model, what would you call it? Please only return the 3D model title, not anything else.`, 
            image)
        .then((results)=>{
            modelName = results
            console.log(modelName.toString())
            modelSearch = encodeURIComponent(modelName)
            console.log(modelSearch)
            modelData = fetchModel(modelSearch).then(data => {
            console.log('Response data:', data);
            const hits = data.hits
            console.log(hits)
            const modelUrl=hits[0].public_url
            console.log(modelUrl)
            puter.print(modelUrl)
});
        });
        }
    </script>
    <style>
        button {
            width: 98%;
            margin-left: 1%;
        }
        input {
            margin-bottom: 8px;
        }
    </style>
    </body>
</html>